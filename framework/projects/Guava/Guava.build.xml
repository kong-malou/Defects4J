<project name="Guava" basedir="${basedir}">

    <property name="build.home" value="${basedir}" />
    <property name="test.src.home" value="${basedir}/guava-tests/test"/>
    <property name="source.home" value="${basedir}/guava/src" /> 
    <property name="test.home" value="${basedir}/guava-tests/target/test-classes"/>
    <property name="classes.dir" value="${basedir}/guava/target/classes"/>
    <property name="testlib.home" value="${basedir}/guava-testlib/target/classes"/>
	
    <path id="compile.classpath">
        <pathelement path="${classes.dir}"/>
        <fileset dir="${d4j.home}/framework/projects/Guava/lib/">
            <include name="**/*.jar" />
        </fileset>
    </path>

    <path id="d4j.test.classpath">
        <pathelement path="${junit.jar}" />
        <pathelement path="${classes.dir}"/>
        <pathelement path="${test.src.home}"/>		
        <pathelement path="${test.home}"/>
        <pathelement path="${testlib.home}"/>
        <fileset dir="${d4j.home}/framework/projects/Guava/lib/">
            <include name="**/*.jar" />
        </fileset>
	<fileset dir="${basedir}/compileLib">
            <include name="**/*.jar" />
        </fileset>
    </path>

    <path id="major.classpath">
        <path refid="d4j.test.classpath" />
    </path>

    <!-- This script identifies specific versions of particular dependencies -->
    <target name="build-lib" >
        <mkdir dir="${basedir}/compileLib"/>
        <exec executable="/bin/bash">			
            <arg value="${d4j.home}/framework/projects/Guava/d-ver.sh"/>
            <arg value="${basedir}"/>
            <arg value="${d4j.home}/framework/projects/Guava/multi-v-lib"/>
        </exec>
    </target>

    <target name="compile"  depends="build-lib" description="Compile the source code.">
        <exec dir="${basedir}" executable="/bin/bash">			
            <arg line="mvn -pl 'guava,guava-testlib,guava-tests,.' compile -U"/>
        </exec>  
    </target>
  
    <target name="compile.tests" depends="build-lib,compile" description="Compile the tests.">
       <exec dir="${basedir}" executable="/bin/bash">
            <arg line="mvn -pl 'guava,guava-testlib,guava-tests,.' test-compile -U"/>
       </exec>
    </target>

    <!-- List of all developer-written tests that reliably pass on the fixed version -->
    <fileset id="all.manual.tests" dir="${test.home}" excludes="${d4j.tests.exclude}">
        <include name="**/*Test.class"/>
        <exclude name="**/*Abstract*.class"/>
        <exclude name="**/AggregateFutureStateFallbackAtomicHelperTest.class"/>
        <exclude name="**/LongAdderTest.class"/>
        <exclude name="**/AnnotatedSubscriberFinderTests*.class"/>
    </fileset>

    <!-- List of relevant developer-written tests that reliably pass on the fixed version -->
    <fileset id="rel.manual.tests" dir="${test.home}"
        includesfile="${d4j.home}/framework/projects/${d4j.project.id}/relevant_tests/${d4j.bug.id}" />
</project>

